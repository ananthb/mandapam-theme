{{- $contact := .Site.Data.contact -}}
{{- $calendar := $contact.calendar -}}
{{- if $calendar -}}
{{- $baseUrl := $calendar.base_url -}}
{{- $viewCalendarId := default $calendar.calendar_id $calendar.view_calendar_id -}}
{{- $viewSlug := default $calendar.slug $calendar.view_slug -}}
{{- $bookCalendarId := default $calendar.calendar_id $calendar.book_calendar_id -}}
{{- $bookSlug := default $calendar.slug $calendar.book_slug -}}
{{- $defaultView := default "month" $calendar.default_view -}}

<section id="calendar" class="calendar-section">
    <div class="container">
        <div class="row">
            {{/* Calendar View Column */}}
            <div class="col-lg-7 mb-4">
                <div class="calendar-view-container">
                    <h2>{{ default "Event Calendar" $calendar.view_title }}</h2>
                    <div class="calendar-view-controls">
                        <button type="button" class="btn btn-sm btn-outline-primary calendar-view-btn active" data-view="month">Month</button>
                        <button type="button" class="btn btn-sm btn-outline-primary calendar-view-btn" data-view="week">Week</button>
                        <button type="button" class="btn btn-sm btn-outline-primary calendar-view-btn" data-view="year">Year</button>
                    </div>
                    <div class="calendar-view-wrapper">
                        <iframe
                            id="calendar-view-iframe"
                            class="calendar-iframe"
                            src="{{ $baseUrl }}/view/{{ $viewCalendarId }}/{{ $viewSlug }}?view={{ $defaultView }}"
                            loading="lazy"
                            title="Event Calendar">
                        </iframe>
                    </div>
                </div>
            </div>

            {{/* Booking Form Column */}}
            {{ if $calendar.booking_enabled }}
            <div class="col-lg-5 mb-4">
                <div class="calendar-booking-container">
                    <h2>{{ default "Book Your Event" $calendar.booking_title }}</h2>
                    <div class="calendar-booking-wrapper">
                        <iframe
                            id="calendar-booking-iframe"
                            class="calendar-iframe"
                            src="{{ $baseUrl }}/book/{{ $bookCalendarId }}/{{ $bookSlug }}"
                            loading="lazy"
                            title="Book Your Event">
                        </iframe>
                    </div>
                </div>
            </div>
            {{ end }}
        </div>
    </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const baseUrl = {{ $baseUrl | safeJS }};
    const viewCalendarId = {{ $viewCalendarId | safeJS }};
    const viewSlug = {{ $viewSlug | safeJS }};
    const viewIframe = document.getElementById('calendar-view-iframe');
    const viewButtons = document.querySelectorAll('.calendar-view-btn');

    // Handle view switching
    viewButtons.forEach(btn => {
        btn.addEventListener('click', function() {
            const view = this.dataset.view;
            const url = `${baseUrl}/view/${viewCalendarId}/${viewSlug}?view=${view}`;

            // Update active state
            viewButtons.forEach(b => b.classList.remove('active'));
            this.classList.add('active');

            // Update iframe src
            viewIframe.src = url;
        });
    });
});
</script>
{{- end -}}
